# Урок 5: Cron и логирование

### Цели и задачи

В [предыдущем задании](04_database.md) мы создали таблицу в базе данных и подготовили модель и коллекцию для работы с данными в ней. Теперь мы должны вместо обычной отправки писем реализовать отложенную отправку с применением Magento Cron. И, конечно, добавить логирование ошибок отправки писем.

### Теория

- [Create and setup a cron job in Magento](https://www.cloudways.com/blog/setup-magento-cron-job/)
- [Гайд: Пишем логи в Magento](http://www.magefast.com/%D0%BF%D0%B8%D1%88%D0%B5%D0%BC-%D0%BB%D0%BE%D0%B3%D0%B8-%D0%B2-magento/)

### Практика

Разберем задание более детально. Итак, общий алгоритм будет выглядеть следующим образом:

1. Пользователь делает отправку данных из формы на сервер
2. Полученные данные сохраняются в таблицу и этой записи присваивается статус _"new"_
3. Периодически Magento будет запускать cron задачу из модуля
4. В ней будет производиться выборка всех записей со статусом _"new"_ и выполняться отправка писем
5. Если отправка прошла успешно, то у записи устанавливается статус _"success"_
6. Если же при отправке произошла ошибка, то мы устанавливаем статус _"error"_ и добавляем в лог информацию об ошибке

Изменения в структуру таблицы в базе обязательно должны вноситься через setup-скрипты. Файл с логом ошибок должен иметь название _opsway_feedback.log_.
